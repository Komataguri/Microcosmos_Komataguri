<!DOCTYPE html>
<html lang="ru">
<head>
<<<<<<< HEAD
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Приди, меч!</title>
  <style>
    /* Ваши оригинальные стили без изменений */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: #101010;
      color: white;
      line-height: 1.6;
      padding: 20px;
      font-size: 16px;
    }

    .container {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      gap: 20px;
      margin-top: 20px;
    }

    .book-cover {
      flex: 0 0 auto;
      width: 100%;
      max-width: 315px;
      height: auto;
      object-fit: cover;
      border-radius: 10px;
      align-self: stretch;
    }

    .book-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .book-title {
      font-size: 25px;
      margin-bottom: 10px;
      text-align: center;
      text-decoration: underline;
    }

    .book-description {
      font-size: 16px;
      margin-bottom: 30px;
      text-align: justify;
    }

    .author, .release-year, .genres, .tags, .alternative-title, .chapter-count {
      margin-bottom: 10px;
      font-size: 16px;
    }

    .toc-item a {
      text-decoration: underline;
      color: white;
      transition: color 0.3s;
    }

    .toc-item a:hover {
      color: #ff6347;
    }

    .table-of-contents {
      list-style: none;
      padding: 0;
      margin-top: 20px;
      text-align: left;
    }

    h3 {
      margin-top: 20px;
      text-align: center;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        align-items: center;
      }

      .book-cover {
        width: 80%;
        max-width: 250px;
        height: auto;
        margin: 0 auto;
      }

      .book-info {
        text-align: left;
      }

      .book-description {
        max-width: 100%;
        font-size: 16px;
        text-align: justify;
      }

      h3 {
        margin-top: 20px;
        margin-bottom: 20px;
        text-align: center;
      }

      .table-of-contents {
        margin-top: 15px;
      }

      .toc-item {
        text-align: left;
      }
    }

    /* Новые стили для превью */
    .loader {
      display: none;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #ff6347;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <img src="path-to-your-book1-cover.jpg" alt="Обложка книги Приди, меч!" class="book-cover">
      <div class="book-info">
        <h2 class="book-title">Приди, меч!</h2>
        <p><span>Автор:</span> 烽火戏剧王子</p>
        <p><span>Год выпуска:</span> 2017</p>
        <p><span>Количество глав:</span> 1162 (выпуск продолжается)</p>
        <p><span>Альтернативное название:</span> 剑来 / Jian Lai / Меч грядущего</p>
        <p><span>Жанры:</span> боевые искусства, драма, приключения, сёнэн, сянься (XianXia), фэнтези</p>
        <p><span>Тэги:</span> алхимия, буддизм, главный герой мужчина, древний мир, культивация, сирота, спокойный главный герой</p>
        <p class="book-description">
          <span>Аннотация:</span> Каких только чудес не бывает на свете.
          В центре мироздания обитает ученый, который однажды мечом рассек водопад Небесной реки, и никто из людей не гордится собой так, как он.
          На краю утесов Восточного моря обосновался безымянный даос, не пожелавший вознестись и прозябать на вершине горы. Он лишь хочет, чтобы прохладный ветерок овевал его лицо.
          В Западном раю живет старый монах, что любит рассказывать людям истории. Он держит девять небесных драконов.
          В Диких землях на южных окраинах живет слепой художник, заставивший марионеток в золотых доспехах сдвинуть множество огромных гор для создания прекрасной картины.
          Однажды бедный юноша, выросший на севере, увидел над головой тысячи бессмертных, летящих на мечах, подобно стае саранчи. Тогда ему захотелось пойти и своими глазами увидеть того ученого мужа, о котором рассказывал сказитель, а также бушующие приливы Восточного моря, бескрайние пески Запада и величественные горы Южной пустоши.
          И вот настал день, когда юноша взял деревянный меч и отправился на юг.
        </p>
      </div>
    </div>
  </header>

  <section>
    <h3>Содержание:</h3>
    <div class="loader" id="loader"></div>
    <ul class="table-of-contents" id="toc-list"></ul>
  </section>

  <script>
    // Конфигурация
    const REPO_OWNER = 'Komataguri';
    const REPO_NAME = 'Microcosmos_Komataguri';
    const CHAPTERS_PATH = 'chapters';

    // Элементы DOM
    const loader = document.getElementById('loader');
    const tocList = document.getElementById('toc-list');

    // Показать/скрыть лоадер
    function toggleLoader(show) {
      loader.style.display = show ? 'block' : 'none';
    }

    // Получить номер главы из названия файла
    function getChapterNumber(fileName) {
      const match = fileName.match(/\d+/);
      return match ? parseInt(match[0]) : 0;
    }

    // Загрузить содержание
    async function loadTableOfContents() {
      try {
        toggleLoader(true);
        
        const response = await fetch(
          `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${CHAPTERS_PATH}`
        );
        
        if (!response.ok) throw new Error('Ошибка загрузки');
        
        const files = await response.json();
        
        // Фильтрация и сортировка
        const chapters = files
          .filter(file => file.name.endsWith('.md'))
          .sort((a, b) => getChapterNumber(a.name) - getChapterNumber(b.name));
        
        // Генерация HTML
        tocList.innerHTML = chapters.map(chapter => `
          <li class="toc-item">
            <a href="https://komataguri.github.io/Microcosmos_Komataguri/chapter.html?path=${encodeURIComponent(chapter.path)}">
              ${chapter.name.replace('.md', '')}
            </a>
          </li>
        `).join('');

      } catch (error) {
        console.error('Ошибка:', error);
        tocList.innerHTML = '<li>Не удалось загрузить содержание</li>';
      } finally {
        toggleLoader(false);
      }
    }

    // Запуск при загрузке страницы
    window.addEventListener('DOMContentLoaded', loadTableOfContents);
  </script>

=======
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Чтение главы</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
            position: relative;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            background: #2a2a2a;
            border: 1px solid #404040;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: #3a3a3a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .chapter-title {
            font-size: 2.2rem;
            color: #7aa2f7;
            margin-bottom: 2rem;
            text-align: center;
            padding: 1rem;
            border-bottom: 2px solid #303030;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            font-size: 1.1rem;
            color: #c0c0c0;
            padding: 1rem 0;
        }

        .content strong {
            color: #ff7b72;
            font-weight: 600;
        }

        .content em {
            color: #79c0ff;
            font-style: italic;
        }

        .content img {
            max-width: 100%;
            height: auto;
            margin: 1.5rem 0;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            transition: transform 0.3s ease;
        }

        .content img:hover {
            transform: scale(1.02);
        }

        .scroll-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #2a2a2a;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s ease;
            border: 1px solid #404040;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .scroll-top:hover {
            opacity: 1;
            transform: translateY(-5px);
        }

        .scroll-top::after {
            content: "↑";
            color: #fff;
            font-size: 1.4rem;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .chapter-title {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 0.6rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-buttons">
            <a href="book.html" class="btn">← Назад к содержанию</a>
            <div>
                <button class="btn" id="prevBtn">← Предыдущая</button>
                <button class="btn" id="nextBtn">Следующая →</button>
            </div>
        </div>

        <h1 class="chapter-title" id="chapterTitle"></h1>
        <div class="content" id="content"></div>
    </div>

    <div class="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})"></div>

    <script>
        const REPO_OWNER = 'Komataguri';
        const REPO_NAME = 'Microcosmos_Komataguri';
        const IMAGES_PATH = 'chapters/images';

        // Защита контента
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
        document.addEventListener('dragstart', e => e.preventDefault());

        // Инициализация Showdown
        const converter = new showdown.Converter({
            tables: true,
            simplifiedAutoLink: true,
            strikethrough: true,
            emoji: true
        });

        // Получение параметров URL
        const params = new URLSearchParams(window.location.search);
        const currentPath = params.get('path');

        // Проверка параметра
        if (!currentPath) {
            document.body.innerHTML = `
                <div class="container">
                    <h1 style="color: #ff4444">Ошибка!</h1>
                    <p>Глава не выбрана</p>
                    <a href="book.html" class="btn">Вернуться к содержанию</a>
                </div>
            `;
            throw new Error('Path parameter missing');
        }

        // Обработка изображений
        function processImages() {
            document.querySelectorAll('.content img').forEach(img => {
                const filename = img.src.split('/').pop();
                img.src = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${IMAGES_PATH}/${filename}`;
                img.onerror = () => img.style.opacity = '0.5';
            });
        }

        // Загрузка главы
        async function loadChapter() {
            try {
                const response = await fetch(
                    `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${currentPath}`
                );
                const text = await response.text();
                
                document.getElementById('chapterTitle').textContent = 
                    currentPath.split('/').pop().replace('.md', '');
                
                document.getElementById('content').innerHTML = converter.makeHtml(text);
                processImages();
                updateNavigation();
            } catch (error) {
                document.getElementById('content').innerHTML = 
                    '<p style="color: #ff4444">Ошибка загрузки главы</p>';
            }
        }

        // Навигация по главам
        async function updateNavigation() {
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/chapters`
                );
                const files = await response.json();
                const chapters = files
                    .filter(file => file.name.endsWith('.md'))
                    .sort((a, b) => 
                        parseInt(a.name.match(/\d+/)[0]) - 
                        parseInt(b.name.match(/\d+/)[0]));

                const currentIndex = chapters.findIndex(ch => ch.path === currentPath);
                
                document.getElementById('prevBtn').disabled = currentIndex <= 0;
                document.getElementById('nextBtn').disabled = currentIndex >= chapters.length - 1;

                if(currentIndex > 0) {
                    document.getElementById('prevBtn').onclick = () => 
                        window.location.href = `chapter.html?path=${encodeURIComponent(chapters[currentIndex - 1].path)}`;
                }

                if(currentIndex < chapters.length - 1) {
                    document.getElementById('nextBtn').onclick = () => 
                        window.location.href = `chapter.html?path=${encodeURIComponent(chapters[currentIndex + 1].path)}`;
                }
            } catch (error) {
                console.error('Ошибка навигации:', error);
            }
        }

        // Инициализация
        window.onload = () => {
            loadChapter();
        };

        // Кнопка "Вверх"
        window.addEventListener('scroll', () => {
            document.querySelector('.scroll-top').style.display = 
                window.scrollY > 500 ? 'flex' : 'none';
        });
    </script>
>>>>>>> 0965c32569d279919d60b4c5bf31359111bc8bc0
</body>
</html>